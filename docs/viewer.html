<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ChamberAI Docs Viewer</title>
    <meta name="description" content="Markdown documentation viewer for ChamberAI." />
    <link rel="stylesheet" href="./styles.css" />
    <style>
      .doc-shell {
        max-width: 1000px;
        margin: 0 auto;
      }

      .doc-toolbar {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 16px;
      }

      .doc-toolbar input,
      .doc-toolbar select {
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 10px 12px;
        font-size: 14px;
        font-family: inherit;
      }

      .doc-content {
        background: #fff;
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 20px;
      }

      .doc-content h1,
      .doc-content h2,
      .doc-content h3 {
        font-family: "Fraunces", "Georgia", serif;
      }

      .doc-content pre {
        background: #f7f2e9;
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 12px;
        overflow: auto;
      }

      .doc-content code {
        background: #f7f2e9;
        border-radius: 6px;
        padding: 1px 4px;
      }

      .doc-content pre code {
        background: transparent;
        padding: 0;
      }

      .doc-error {
        color: #b74f36;
        font-weight: 600;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </head>
  <body>
    <div class="bg-grid"></div>
    <header class="site-header">
      <div class="brand">ChamberOfCommerceAI Docs</div>
      <nav class="nav">
        <a href="./index.html">Home</a>
      </nav>
    </header>

    <main class="doc-shell">
      <section class="section">
        <h1 id="docTitle">Documentation</h1>
        <div class="doc-toolbar">
          <select id="docSelect">
            <option value="INDEX.md">Docs Index</option>
            <option value="USER_GUIDE.md">User Guide</option>
            <option value="PRODUCT_INFO.md">Product Info</option>
            <option value="IMPLEMENTATION_REVIEW_2026-02-25.md">Implementation Review</option>
            <option value="DEPLOYMENT_GCP_VERCEL_LOW_COST.md">GCP + Vercel Deployment</option>
            <option value="RELEASE_CHECKLIST.md">Release Checklist</option>
          </select>
          <input id="docInput" type="text" placeholder="Custom markdown path, e.g. roadmap.md" />
          <button id="loadDocBtn" class="btn ghost" type="button">Load</button>
        </div>
        <article id="docContent" class="doc-content">Loading...</article>
      </section>
    </main>

    <script>
      const params = new URLSearchParams(window.location.search);
      const docSelect = document.getElementById("docSelect");
      const docInput = document.getElementById("docInput");
      const loadDocBtn = document.getElementById("loadDocBtn");
      const docTitle = document.getElementById("docTitle");
      const docContent = document.getElementById("docContent");

      function sanitizeDocPath(value) {
        const path = String(value || "").trim();
        if (!path.endsWith(".md")) return "";
        if (path.includes("..")) return "";
        if (path.startsWith("http://") || path.startsWith("https://")) return "";
        return path.replace(/^\.?\//, "");
      }

      function humanTitle(path) {
        return path.replace(/\.md$/i, "").replace(/[_-]+/g, " ");
      }

      async function loadDoc(path) {
        const safePath = sanitizeDocPath(path);
        if (!safePath) {
          docContent.innerHTML = '<p class="doc-error">Invalid markdown file path.</p>';
          return;
        }

        const response = await fetch(`./${safePath}`, { cache: "no-cache" });
        if (!response.ok) {
          docContent.innerHTML = `<p class="doc-error">Unable to load ${safePath} (HTTP ${response.status}).</p>`;
          return;
        }

        const markdown = await response.text();
        docTitle.textContent = humanTitle(safePath);
        docContent.innerHTML = marked.parse(markdown);
        history.replaceState({}, "", `?doc=${encodeURIComponent(safePath)}`);
      }

      loadDocBtn.addEventListener("click", () => {
        const custom = sanitizeDocPath(docInput.value);
        if (custom) {
          loadDoc(custom);
          return;
        }
        loadDoc(docSelect.value);
      });

      docSelect.addEventListener("change", () => {
        docInput.value = "";
        loadDoc(docSelect.value);
      });

      const initialDoc = sanitizeDocPath(params.get("doc")) || "INDEX.md";
      if ([...docSelect.options].some((opt) => opt.value === initialDoc)) {
        docSelect.value = initialDoc;
      } else {
        docInput.value = initialDoc;
      }
      loadDoc(initialDoc);
    </script>
  </body>
</html>
